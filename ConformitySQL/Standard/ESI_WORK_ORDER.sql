CREATE OR REPLACE VIEW ESI_WORK_ORDER AS
SELECT awo.wo_no                          wo_no,
       awo.err_descr                      err_descr,
       awo.plan_s_date                    plan_s_date,
       awo.work_done                      work_done,
       awo.vendor_no                      vendor_no,
       Pm_Type_API.Decode(awo.pm_type)    pm_type,
       awo.pm_type                        pm_type_db,
       awo.reported_by_id                 reported_by_id,
       Company_Emp_API.Get_Person_Id(Site_API.Get_Company(awo.contract), reported_by_id)
                                      reported_by,
       awo.priority_id                    priority_id,
       awo.org_code                       org_code,
       awo.err_class                      err_class,
       awo.err_type                       err_type,
       awo.err_discover_code              err_discover_code,
       awo.err_symptom                    err_symptom,
       awo.work_type_id                   work_type_id,
       awo.call_code                      call_code,
       substr(Site_API.Get_Company(awo.CONTRACT),1,20) awo_company,
       Pre_Accounting_Api.Get_Cost_Center(awo.pre_accounting_id)    cost_center,
       Pre_Accounting_Api.Get_Object_No(awo.pre_accounting_id)    object_no,
       awo.action_code_id                 action_code_id,
       awo.contract                   contract,
       awo.mch_code                       mch_code,
       awo.performed_action_id            performed_action_id,
       awo.op_status_id                   op_status_id,
       awo.err_cause                      err_cause,
       awo.test_point_id                  test_point_id,
       awo.func_test_org                  func_test_org,
       awo.work_master_sign_id            work_master_sign_id,
       Company_Emp_API.Get_Person_Id(Site_API.Get_Company(awo.contract), work_master_sign_id)
                                      work_master_sign,
       awo.work_leader_sign_id            work_leader_sign_id,
       Company_Emp_API.Get_Person_Id(Site_API.Get_Company(awo.contract), work_leader_sign_id)
                                      work_leader_sign,
       awo.rounddef_id                    rounddef_id,
       awo.prepared_by_id                 prepared_by_id,
       Company_Emp_API.Get_Person_Id(Site_API.Get_Company(awo.contract), prepared_by_id)  prepared_by,
       awo.authorize_code                 authorize_code,
       awo.func_test_sign_id              func_test_sign_id,
       Company_Emp_API.Get_Person_Id(Site_API.Get_Company(awo.contract), func_test_sign_id)
                                      func_test_sign,
       awo.pm_no                          pm_no,
       awo.pm_revision                    pm_revision,
       awo.role_code                      role_code,
       awo.project_no                     project_no,
       awo.reg_date                       reg_date,
       awo.err_cause_lo                   err_cause_lo,
       awo.err_descr_lo                   err_descr_lo,
       awo.plan_f_date                    plan_f_date,
       awo.real_s_date                    real_s_date,
       awo.real_f_date                    real_f_date,
       awo.work_descr_lo                  work_descr_lo,
       awo.bud_pers_cost                  bud_pers_cost,
       awo.bud_mat_cost                   bud_mat_cost,
       awo.bud_ext_cost                   bud_ext_cost,
       awo.bud_tools_cost                 bud_tools_cost,
       awo.sync_with_std_bud              sync_with_std_bud,
       awo.performed_action_lo            performed_action_lo,
       awo.func_test                      func_test,
       awo.func_test_descr                func_test_descr,
       awo.pm_descr                       pm_descr,
       awo.plan_hrs                       plan_hrs,
       awo.real_hrs                       real_hrs,
       Pre_Accounting_Api.Get_Codeno_C(pre_accounting_id)                         code_c,
       Pre_Accounting_Api.Get_Codeno_D(pre_accounting_id)                         code_d,
       Pre_Accounting_Api.Get_Codeno_G(pre_accounting_id)                         code_g,
       Pre_Accounting_Api.Get_Codeno_H(pre_accounting_id)                         code_h,
       Pre_Accounting_Api.Get_Codeno_I(pre_accounting_id)                         code_i,
       Pre_Accounting_Api.Get_Codeno_J(pre_accounting_id)                         code_j,
       awo.activity_seq                   activity_seq,
       awo.test_number                    test_number,
       awo.instruction                    instruction,
       awo.materials                      materials,
       awo.plan_s_week                    plan_s_week,
       awo.plan_f_week                    plan_f_week,
       awo.pre_accounting_id              pre_accounting_id,
       awo.note                           note,
       awo.last_activity_date             last_activity_date,
       awo.note_id                        note_id,
       awo.required_start_date            required_start_date,
       awo.required_end_date              required_end_date,
       awo.report_in_by_id                report_in_by_id,
       Company_Emp_API.Get_Person_Id(Site_API.Get_Company(awo.contract), report_in_by_id)
                                      report_in_by,
       nvl(awo.repair_flag,'FALSE')       repair_flag,
       awo.contact                        contact,
       awo.phone_no                       phone_no,
       awo.customer_no                    customer_no,
       Work_Order_Address_API.Get_Address1(awo.WO_NO)  address1,
       Work_Order_Address_API.Get_Address2(awo.WO_NO)  address2,
       Work_Order_Address_API.Get_Address3(awo.WO_NO)  address3,
       Work_Order_Address_API.Get_Address4(awo.WO_NO)  address4,
       Work_Order_Address_API.Get_Address5(awo.WO_NO)  address5,
       Work_Order_Address_API.Get_Address6(awo.WO_NO)  address6,
       Work_Order_Address_API.Get_Address7(awo.WO_NO)  address7,
       NULL                           std_job_flag,
       RPAD(' ',50)                   address_id,
       awo.agreement_id                   agreement_id,
       awo.bud_exp_cost                   bud_exp_cost,
       awo.bud_fixed_cost                 bud_fixed_cost,
       awo.reference_no                   reference_no,
       Fixed_Price_API.Decode(awo.fixed_price) fixed_price,
       awo.fixed_price                    fixed_price_db,
       awo.fault_rep_flag                 fault_rep_flag,
       awo.quotation_id                   quotation_id,
       Equipment_Functional_API.Get_Criticality(mch_code_contract,mch_code)  criticality,
       Equipment_Object_API.Get_Group_Id(mch_code_contract,mch_code)         group_id,
       awo.cust_order_type                cust_order_type,
       awo.cust_order_no                  cust_order_no,
       awo.cust_order_line_no             cust_order_line_no,
       awo.cust_order_rel_no              cust_order_rel_no,
       awo.cust_order_line_item_no        cust_order_line_item_no,
       Generate_Note_API.Decode(generate_note) generate_note,
       awo.generate_note                  generate_note_db,
       awo.seq_no                         seq_no,
       awo.gen_id                         gen_id,
       awo.warranty_row_no                warranty_row_no,
       awo.currency_code                  currency_code,
       awo.repair_part_no                 repair_part_no,
       awo.repair_part_contract           repair_part_contract,
       nvl( awo.non_serial_repair_flag, 'FALSE') non_serial_repair_flag,
       Non_Serial_Location_API.Decode(awo.non_serial_location)  non_serial_location,
       awo.non_serial_location            non_serial_location_db,
       awo.obj_cust_warranty              obj_cust_warranty,
       awo.obj_sup_warranty               obj_sup_warranty,
       awo.cust_warranty                  cust_warranty,
       awo.cust_warr_type                 cust_warr_type,
       awo.sup_warranty                   sup_warranty,
       awo.sup_warr_type                  sup_warr_type,
       awo.ncf_inv_stat_fee               ncf_inv_stat_fee,
       awo.planned_man_hrs                planned_man_hrs,
       awo.mch_code_contract              mch_code_contract,
       decode(awo.connection_type,'VIM',Active_Work_Order_Util_Api.Get_Vim_Obj_Description(awo.wo_no),Maintenance_Object_Api.Get_Mch_Name(awo.mch_code_contract, awo.mch_code)) mch_code_description,
       Maint_Connection_Type_API.Decode(connection_type) connection_type,
       awo.connection_type                connection_type_db,
       awo.receive_order_no               receive_order_no,
       awo.complex_agreement_id           complex_agreement_id,
       Equipment_Serial_API.Get_Part_No(mch_code_contract,mch_code) awo_part_no,
       Equipment_Serial_API.Get_Serial_No(mch_code_contract,mch_code) awo_serial_no,
       awo.lot_batch_no                   awo_lot_batch_no,
       Active_Separate_API.Is_Project_Connected(awo.WO_NO) project_connected,
       awo.case_id                        case_id,
       awo.task_id                        task_id,
       awo.context                        context,
       awo.cust_add_id                    cust_add_id,
       Scheduling_Constraints_API.Decode(scheduling_constraints) scheduling_constraints,
       scheduling_constraints         scheduling_constraints_db,
       awo.rowid                         objid,
       ltrim(lpad(to_char(rowversion),2000))                    objversion,
       awo.wo_status_id                      objstate,
       Active_Work_Order_API.Finite_State_Events__(wo_status_id)                     objevents,
       Client_SYS.Get_Key_Reference('ActiveSeparate', 'WO_NO', awo.WO_NO) wo_key_value,
       decode(awo.activity_seq,'',0,1)    activity_connected,
       awo.contract_id                    contract_id,
       awo.line_no                        line_no,
       awo.location_id                    location_id,
       NULL                           condition_code,
       text_id$                       text_id$,
       awo.temp_mob_wo                    temp_mob_wo,
       awo.source                         awo_source,
       awo.source_id                      source_id,
       Active_Work_Order_API.Finite_State_Decode__(awo.wo_status_id)                         state,
  emmrl.MAINT_MATERIAL_ORDER_NO             MAINT_MATERIAL_ORDER_NO,
  emmrl.SIGNATURE_ID                                    SIGNATURE_ID,
  emmrl.INT_DESTINATION_ID                              INT_DESTINATION_ID,
  emmrl.DUE_DATE                                        DUE_DATE,
  emmrl.ENTERED                                         ENTERED,
  emmrl.MMR_WO_NO                                       MMR_WO_NO,
  emmrl.SIGNATURE                                       SIGNATURE,
  emmrl.INT_DESTINATION_DESC                            INT_DESTINATION_DESC,
  emmrl.CONTRACT                                        emmrl_CONTRACT,
  emmrl.COMPANY                                         emmrl_COMPANY,
  emmrl.ACTIVITY_SEQ                                    emmrl_ACTIVITY_SEQ,
  emmrl.MULT_REQ_LINE                                   MULT_REQ_LINE,
  emmrl.MAINT_MAT_REQUIS_OBJID                          MAINT_MAT_REQUIS_OBJID,
  emmrl.MAINT_MAT_REQUIS_OBJVERSION                     MAINT_MAT_REQUIS_OBJVERSION,
  emmrl.MAINT_MAT_REQUIS_OBJSTATE                       MAINT_MAT_REQUIS_OBJSTATE,
  emmrl.MAINT_MAT_REQUIS_OBJEVENTS                      MAINT_MAT_REQUIS_OBJEVENTS,
  emmrl.MAINT_MAT_REQUIS_STATE                          MAINT_MAT_REQUIS_STATE,
  emmrl.LINE_ITEM_NO                                    LINE_ITEM_NO,
  emmrl.PART_NO                                         PART_NO,
  emmrl.SPARE_CONTRACT                                  SPARE_CONTRACT,
  emmrl.DATE_REQUIRED                                   DATE_REQUIRED,
  emmrl.PLAN_QTY                                        PLAN_QTY,
  emmrl.QTY                                             QTY,
  emmrl.QTY_SHORT                                       QTY_SHORT,
  emmrl.QTY_ASSIGNED                                    QTY_ASSIGNED,
  emmrl.QTY_RETURNED                                    QTY_RETURNED,
  emmrl.CATALOG_CONTRACT                                CATALOG_CONTRACT,
  emmrl.CATALOG_NO                                      CATALOG_NO,
  emmrl.PRICE_LIST_NO                                   PRICE_LIST_NO,
  emmrl.LIST_PRICE                                      LIST_PRICE,
  emmrl.SALE_UNIT_PRICE                                 SALE_UNIT_PRICE,
  emmrl.DISCOUNT                                        DISCOUNT,
  emmrl.QTY_TO_INVOICE                                  QTY_TO_INVOICE,
  emmrl.COST                                            COST,
  emmrl.WO_NO                                           emmrl_WO_NO,
  emmrl.PLAN_LINE_NO                                    PLAN_LINE_NO,
  emmrl.OBJSTATE                                        emmrl_OBJSTATE,
  emmrl.REQUISITION_NO                                  REQUISITION_NO,
  emmrl.LINE_NO                                         emmrl_LINE_NO,
  emmrl.RELEASE_NO                                      RELEASE_NO,
  emmrl.SERIAL_NO                                       emmrl_SERIAL_NO,
  emmrl.CRAFT_LINE_NO                                   CRAFT_LINE_NO,
  emmrl.CONDITION_CODE                                  emmrl_CONDITION_CODE,
  emmrl.PART_OWNERSHIP                                  PART_OWNERSHIP,
  emmrl.PART_OWNERSHIP_DB                               PART_OWNERSHIP_DB,
  emmrl.OWNER                                           OWNER,
  emmrl.SUPPLY_CODE                                     SUPPLY_CODE,
  emmrl.SUPPLY_CODE_DB                                  SUPPLY_CODE_DB,
  emmrl.JOB_ID                                          JOB_ID,
  emmrl.STD_JOB_SEQ                                     STD_JOB_SEQ,
  emmrl.OBJID                                           emmrl_OBJID,
  emmrl.OBJVERSION                                      emmrl_OBJVERSION,
       INV.location_no                            location_no,
       INV.location_group                location_group,
       INV.warehouse                     warehouse,
       INV.bay_no                        bay_no,
       INV.row_no                        row_no,
       INV.tier_no                       tier_no,
       INV.bin_no                        bin_no,
       INV.location_name                 location_name,
       INV.location_type                 location_type,
       INV.location_type_db              location_type_db,
       INV.lot_batch_no                   lot_batch_no,
       INV.serial_no                      serial_no,
       INV.eng_chg_level                  eng_chg_level,
       INV.waiv_dev_rej_no                waiv_dev_rej_no,
       INV.configuration_id               configuration_id,
       INV.avg_unit_transit_cost          avg_unit_transit_cost,
       INV.count_variance                 count_variance,
       INV.expiration_date                expiration_date,
       INV.freeze_flag                    freeze_flag,
       INV.freeze_flag_db                 freeze_flag_db,
       INV.last_count_date                last_count_date,
       INV.qty_in_transit                 qty_in_transit,
       INV.qty_onhand                     qty_onhand,
       INV.qty_reserved                   qty_reserved,
       INV.receipt_date                   receipt_date,
       INV.source                         source,
       INV.availability_control_id        availability_control_id,
       INV.objid                          location_objid,
       INV.objversion                     location_objversion  
FROM   active_work_order_tab awo,
       ESI_MAINT_MATERIAL_REQUIS_LINE emmrl,
       ESI_INVENTORY_PART_IN_STOCK INV
WHERE  pm_type = 'ActiveSeparate'
AND    connection_type != 'CRO'
AND    awo.wo_no = emmrl.mmr_wo_no (+)
AND    emmrl.part_no = INV.part_no
AND    awo.contract = INV.contract
AND    awo.contract = emmrl.spare_contract
WITH   read only;
